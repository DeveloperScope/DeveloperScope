==== File: ownerlist/utils.py ====
@@ -2486,6 +2486,7 @@ def omni_check_status(id=None, proxy=None):
         )
     except Exception as e:
         logger.error(f"Ошибка авторизации LDAP: {e}")
+        print(f"Ошибка авторизации LDAP: {e}")
 
     try:
         r = requests.post(
@@ -2502,23 +2503,20 @@ def omni_check_status(id=None, proxy=None):
                 if result and len(result) > 3:
                     result = result.split('strResponse">')
                     result = result[1].split("</")[0]
-                # return result
+                return OMNI_ACL_STATUS.get(result), OMNI_HTTP_STATUS.get(result)
             except Exception as e:
                 logger.error("[Check status] " + str(e))
                 if settings.DEBUG:
                     print(e)
-                # return r.text
+                return None, None
+        else:
+            return None, None
 
     except Exception as e:
-        result = ""
         logger.info(f"Ошибка: {e}")
-
-    finally:
-        if result in OMNI_HTTP_STATUS:
-            return OMNI_ACL_STATUS[result], OMNI_HTTP_STATUS[result]
-        else:
-            return None, None
-        # return OMNI_ACL_STATUS[result], OMNI_HTTP_STATUS[result]
+        send_to_mattermost(f"[omni_check_status] Ошибка: {e}")
+        print(f"[omni_check_status] Ошибка: {e}")
+        return None, None
 
 
 def SendMessageToApprove(acl_id, acl_owner, user, token=""):
@@ -2972,7 +2970,8 @@ def check_acl_in_omni(acl_object):
     if acl_taskid:
         acl_status = acl_object.status
         omni_acl_status, omni_http_status = omni_check_status(acl_taskid)
-        if acl_status != omni_acl_status:
-            acl_object.status = omni_acl_status
-            acl_object.save(update_fields=["status"])
-        return omni_acl_status
+        if omni_acl_status is not None:
+            if acl_status != omni_acl_status:
+                acl_object.status = omni_acl_status
+                acl_object.save(update_fields=["status"])
+            return omni_acl_status


